# 内存分配总结

## 存储区域

---

计算机中的主要存储区域为寄存器、高速缓存、内存、硬盘。其中，寄存器的速度最快，硬盘的速度最慢。

## 内存

---

在 C++ 中，内存主要分为五个区：代码区、栈、堆、全局区（静态区）、字符串常量区。

### 代码区

这一部分主要存放函数体的二进制代码，所有数据都是只读的。

### 栈区

栈上内存由编译器自动分配和释放，主要存放函数的参数值、局部变量的值等。栈内存的分配是连续的。

### 堆区

堆区内存由程序员申请分配，需要手动进行释放。堆内存是不连续的，不同区域的内存块通过指针进行连接，有点类似于链表。

### 全局区（静态区）

全局变量和静态变量是放在一起的。初始化过的全局变量和静态变量放在一起，而未初始化过的全局变量和静态变量则放在另一片区域。该区域在程序结束后会自动释放。

### 字符串常量区

字符串常量会放在该区域，程序结束后自动释放。

### new和malloc的区别

new 操作符从自动存储区上分配内存，malloc 从堆上分配内存。自由存储区是 C++ 基于 new 的一个抽象概念，通过 new 申请的内存都在自由存储区分配。关于自由存储区是否是堆（也就是 new 能否在堆上分配内存），这一点取决于 new 操作符的实现。自由存储区可以是堆，也可以是静态存储区，甚至于你可以让 new 不分配任何内存。

new 操作符分配成功时，返回的是对象类型指针，而 malloc 返回的是 void* 指针。new 操作符分配失败时会抛出异常，malloc 分配失败时返回 NULL。相比之下，C++ 的内存分配要更安全。

new 在分配内存时无需指定大小，而 malloc 需要显示指定大小。

new 在分配内存时会为对象调用构造函数，在释放内存时会调用析构函数，而 malloc 则不会。

对于 C++ 的数组而言，使用 new[] 分配的内存必须由 delete[] 释放：

```cpp
A *ptr = new A[10];
delete [] ptr;
```

new 和 delete 操作符可以被重载，而 malloc 和 free 则不行。