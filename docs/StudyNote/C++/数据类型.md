# 数据类型

这一部分常弄混的是 typedef 和 define 的区别。

## typedef

---

### 基本用法

typedef 与 define 宏替换不同，它不是简单的文本替换，而是类型替换。我们在开发的过程中，经常会出现类型特别复杂的情况。为了方便，我们通常用 typedef 进行简化，减少工作量。最简单的用法是用别名替换类型名，比如 `typedef int* pI`。很多时候，我们不一定是为了简化类型名，而是为了给类型名起一个别名，方便我们理解。

typedef 的用法有很多，比如在 C 程序中，我们实例化 struct 结构体时，必须用 `struct + 结构体名 + 变量名` 的形式，而在 C++ 中则不需要加上 struct。那么为了简单一点，可以用 typedef 简化，这样一来，我们可以直接使用 POINT 来创建结构体变量：

```cpp
typedef struct Position
{
    int x;
    int y;
}POINT;

POINT p1;
```

当然你也可以定义一些平台无关的的类型：

```cpp
typedef int INT;
// 更换为4个字节的类型
typedef long INT;
```

你可以在编程中直接使用 INT，当平台切换时，你只需要简单的修改一下类型声明就能够做到替换。

### 复杂声明替换

不管声明有多复杂，替换时记住一个规则，就是把变量名留到最后，先替换复杂的声明。下面举一些例子：

```cpp
// 这是一个函数指针的数组
int *(*a[5])(int, char*);
// 替换后
typedef int *(*pFun)(int, char*);
pFun a[5];

// 这是一个函数指针的数组，参数为函数指针
void (*b[10]) (void (*)());
// 先替换参数
typedef void (*pParam)();
// 再替换变量名
typedef void (*pFunc)(pParam);
pFunc b[10];

// 这是一个指向数组的指针，数组由函数指针构成
double(*)() (*e)[9];
// 先替换左边
typedef double(*pFunc)();
// 再替换变量名
typedef pFunc (*pPoint)[9];
pPoint e;
```

知道了如何替换，也要知道如何判断复杂声明。判断方法很简单，从变量名开始解读，先往右，碰到括号再往左，然后再跳出括号判断：

```cpp
// 函数指针
int (*func)(int *p);
// 存储函数指针的数组
int (*func[5])(int *);
// 函数，参数为整型变量和函数指针，返回值为函数指针
int(* z(int x, int (*y)(int)))(int);
```

### typedef与define的区别

其实弄明白了之后还是很简单的。举个例子：

```cpp
#define void* VP1
typedef void* VP2;
const VP1 p1;       // const void *p1
const VP2 p2;       // void *const p2
```

我在修饰符一章中讲过，修饰符的先后顺序通常是没有影响的，所以 const 和 VP2 修饰的都是 p2 本身，而 define 就只是文本替换而已。

另外需要注意的是，由于 define 是直接替换，所以它不是类型安全的。