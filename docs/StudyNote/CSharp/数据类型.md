# 数据类型

## 值类型和引用类型

---

值类型有 bool、byte、char、int、double 等等，引用类型有 object、dynamic、string。

### 本质区别

从内存的角度上来看，值类型存储在栈空间，引用类型本身存储在栈空间，但指向的对象放在堆中。引用类型类似于 C++ 中的指针，不过 C# 对指针进行了封装，因此用起来会有些不同。

在参数传递方面，值传递会开辟一片新的内存，并将原本的值复制过来，而引用传递则只是复制引用本身。但要注意，虽然原引用和传进来的引用都指向同一片内存，但是这两个引用本身是有区别的。

具体可以看下面的代码：

```csharp
public class Info
{
    public string str { get; set; }
}

public void ChangeString(Info info)
{
    info = new Info();
    info.str = "World";
}

public void PrintString()
{
    Info info = new Info();
    info.str = "Hello";
    ChangeString(info);
    Console.WriteLine(info.str);
}
```

调用 `PrintString` 打印的结果为 `Hello`，原因是引用传递其实是传递引用的副本，把这个副本指向新的内存是不会影响到原引用的。

如果我们再修改一下：

```csharp
public void ChangeString(ref Info info)
{
    info = new Info();
    info.str = "World";
}
```

打印的结果为 `World`，原因是 ref 关键字会把原本的引用传进来，所以上述操作相当于更改了原引用指向的对象，因此打印结果发生了改变。

### 装箱与拆箱

所谓的装箱与拆箱是针对于 object 而言的。object 是所有数据类型的终极基类，可以被分配任何类型（值类型、引用类型、预定义类型、用户自定义类型）。不过在为其分配值之前，要进行类型转换。

装箱指的是值类型转换成对象类型：

```csharp
int val = 1;
object obj = val;
```

拆箱指的是将由值类型转换成的对象类型再转回到值类型：

```csharp
int val = 1;
object obj = val;       // 先装箱
int val2 = obj as int;  // 再拆箱
```

!> 只有装过箱的数据才能够拆箱。